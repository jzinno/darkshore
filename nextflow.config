ref_bundle = "/gpfs/commons/groups/landau_lab/jzinno/ref"

profiles {
    stub {
        stubRun = true
        process {
            {
                executor = 'local'
                cpus = 1
                memory = '1 GB'
                time = '1h'
            }
        }
        params{
            bam_list = "test/test-dna-input.txt"
            rna_fastq_table = "test/test-rna-input.txt"
            sample_id = "test"
            call_mito = true
        }
    }
}

process {
    executor = 'slurm'
    queue = { task.accelerator ? 'gpu' : (task.memory > 100.GB ? 'bigmem' : 'pe2') }
    errorStrategy = { task.exitStatus in [143,137,104,134,139,250,255,] ? 'retry' : 'terminate' }
    maxRetries = 2
    maxErrors = '-1'
    cache = 'lenient'
    containerOptions = { task.accelerator ? "--bind ${ref_bundle},${projectDir}/.. --nv" : "--bind ${ref_bundle},${projectDir}/.." }
}

executor {
  queueSize = 196
  submitRateLimit = '100/2min'
}

singularity {
  enabled = true
  autoMounts = true
  cacheDir = "${HOME}/.singularity/singularity_images_nextflow"
}

params {
    //input(s) for scVC, scRNA, and Anno respecitively
    bam_list = "bams.txt"  // A text file with the path to each BAM file on a separate line
    rna_fastq_table="rna_test.txt"
    joint_vcf = "test.vcf.gz"
    //output
    out = "output"
    sample_id = "test"
    //resources
    resource_dir = ref_bundle
    ref = "${resource_dir}/hg38/v0/Homo_sapiens_assembly38.fasta"
    ref_idx = "${resource_dir}/hg38/v0/Homo_sapiens_assembly38.fasta.fai"
    star_ref = "${resource_dir}/refdata-gex-GRCh38-2024-A/star/"
    gtf = "${resource_dir}/refdata-gex-GRCh38-2024-A/genes/genes.gtf"
    //size of scatter intervals
    chop = 100000000
    //flags
    flow_mode = true // true for UG, false for Illumina
    call_mito = false
    run_phylo = false
    use_gpu = false
    // RNA specific
    htseq_type = "exon"
}

report {
    enabled = true
    overwrite = true
    file = "nextflow-report.html"
}

timeline {
    enabled = true
    overwrite = true
    file = "timeline.html"
}

dag {
    enabled = true
    overwrite = true
    file = "flowchart.html"
}

manifest {
    name = "darkshore"
    version = "v0.0.1"
    author = ["John Zinno"]
    homePage = "https://github.com/jzinno/darkshore"
    defaultBranch = "main"
    nextflowVersion = "22.10.4+"
}

